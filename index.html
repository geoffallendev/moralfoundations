<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moral Foundations Questionnaire</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        #app {
            max-width: 1600px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 15px 15px 0 0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: rgba(255,255,255,0.7);
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: white;
        }

        .tab.active {
            color: white;
            border-bottom-color: white;
        }


        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: 700;
        }

        .reports-list {
            display: grid;
            gap: 15px;
        }

        .report-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .report-item input[type="checkbox"] {
            margin-right: 15px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .llm-tag {
            display: inline-block;
            padding: 4px 10px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 5px;
            margin-top: 5px;
        }

        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 28px;
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
            font-size: 14px;
            color: #333;
            line-height: 1.8;
        }

        .instructions p {
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        th:last-child {
            text-align: center;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: middle;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .question-cell {
            color: #333;
            font-size: 14px;
            line-height: 1.5;
        }

        .rating-cell {
            text-align: center;
            white-space: nowrap;
        }

        .rating-buttons {
            display: inline-flex;
            gap: 5px;
        }

        .rating-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .rating-btn:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .rating-btn.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        button {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .results-container {
            animation: fadeIn 0.5s ease-in;
        }

        .results-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .result-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .result-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .score-label {
            color: #666;
            font-size: 14px;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .score-bar-bg {
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }

        .score-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .chart-container {
            position: relative;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        table.report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .report-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .report-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 1px;
        }

        .report-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .report-table tbody tr:hover {
            background: #f8f9fa;
        }

        .report-table tbody tr:last-child td {
            border-bottom: none;
        }

        .score-cell {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }

            h1 {
                font-size: 22px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px;
            }

            .rating-btn {
                width: 35px;
                height: 35px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab" :class="{ active: mainTab === 'questionnaire' }" @click="switchMainTab('questionnaire')">
                Take Questionnaire
            </button>
            <button class="tab" :class="{ active: mainTab === 'dashboard' }" @click="switchMainTab('dashboard')">
                Dashboard
            </button>
            <button class="tab" :class="{ active: mainTab === 'compare' }" @click="switchMainTab('compare')">
                Compare Results
            </button>
        </div>

        <div class="card">
            <!-- Questionnaire Tab -->
            <div v-show="mainTab === 'questionnaire'">
            <!-- Part 1 Page -->
            <div v-if="currentPage === 1">
                <h1>Part 1: Moral Relevance</h1>

                <div class="instructions">
                    <p style="font-weight: 500;">
                        When you decide whether something is right or wrong, to what extent are the following considerations relevant to your thinking?
                    </p>
                    <p>Please rate each statement using this scale:</p>
                    <ul>
                        <li><strong>0</strong> = not at all relevant (This consideration has nothing to do with my judgments of right and wrong)</li>
                        <li><strong>1</strong> = not very relevant</li>
                        <li><strong>2</strong> = slightly relevant</li>
                        <li><strong>3</strong> = somewhat relevant</li>
                        <li><strong>4</strong> = very relevant</li>
                        <li><strong>5</strong> = extremely relevant (This is one of the most important factors when I judge right and wrong)</li>
                    </ul>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th style="width: 60%;">Question</th>
                            <th>Rating (0-5)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(q, index) in part1Questions" :key="'p1-' + index">
                            <td class="question-cell">{{ q.question }}</td>
                            <td class="rating-cell">
                                <div class="rating-buttons">
                                    <button
                                        v-for="rating in [0, 1, 2, 3, 4, 5]"
                                        :key="rating"
                                        class="rating-btn"
                                        :class="{ selected: answers[q.id] === rating }"
                                        @click="setAnswer(q.id, rating)"
                                    >
                                        {{ rating }}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="button-container">
                    <button class="btn-primary" @click="goToPart2" :disabled="!isPart1Complete">
                        Continue to Part 2 ‚Üí
                    </button>
                </div>
            </div>

            <!-- Part 2 Page -->
            <div v-if="currentPage === 2">
                <h1>Part 2: Agreement/Disagreement</h1>

                <div class="instructions">
                    <p style="font-weight: 500;">
                        Please read the following sentences and indicate your agreement or disagreement
                    </p>
                    <p>Please rate each statement using this scale:</p>
                    <ul>
                        <li><strong>0</strong> = Strongly Disagree</li>
                        <li><strong>1</strong> = Moderately Disagree</li>
                        <li><strong>2</strong> = Slightly Disagree</li>
                        <li><strong>3</strong> = Slightly Agree</li>
                        <li><strong>4</strong> = Moderately Agree</li>
                        <li><strong>5</strong> = Strongly Agree</li>
                    </ul>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th style="width: 60%;">Statement</th>
                            <th>Rating (0-5)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(q, index) in part2Questions" :key="'p2-' + index">
                            <td class="question-cell">{{ q.question }}</td>
                            <td class="rating-cell">
                                <div class="rating-buttons">
                                    <button
                                        v-for="rating in [0, 1, 2, 3, 4, 5]"
                                        :key="rating"
                                        class="rating-btn"
                                        :class="{ selected: answers[q.id] === rating }"
                                        @click="setAnswer(q.id, rating)"
                                    >
                                        {{ rating }}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="button-container">
                    <button class="btn-secondary" @click="goToPart1">
                        ‚Üê Back to Part 1
                    </button>
                    <button class="btn-primary" @click="viewResults" :disabled="!isPart2Complete">
                        View Results
                    </button>
                </div>
            </div>

            <!-- Results Page -->
            <div v-if="currentPage === 3" class="results-container">
                <h1>Your Moral Foundations Profile</h1>
                <p style="color: #666; margin-bottom: 30px;">Generated on {{ new Date().toLocaleDateString() }}</p>

                <!-- Visual Analysis Chart -->
                <div class="chart-container">
                    <h3 style="margin-bottom: 20px; color: #495057;">Sum of Scores by Moral Foundation</h3>
                    <div class="chart-wrapper">
                        <canvas id="foundationChart"></canvas>
                    </div>
                </div>

                <!-- Detailed Scores Table -->
                <div style="margin-top: 40px;">
                    <h2 style="font-size: 1.5em; margin-bottom: 20px; color: #667eea;">Detailed Scores by Moral Foundation</h2>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Moral Foundation</th>
                                <th>Total Score</th>
                                <th>Question Count</th>
                                <th>Max Possible</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(score, foundation) in foundationScores" :key="foundation">
                                <td>{{ foundation }}</td>
                                <td class="score-cell">{{ score.total }}</td>
                                <td>{{ score.count }}</td>
                                <td>{{ score.count * 5 }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="button-container">
                    <button class="btn-secondary" @click="goToPart2">
                        ‚Üê Back to Part 2
                    </button>
                    <button class="btn-primary" @click="downloadJSON">
                        Download JSON Results
                    </button>
                    <button class="btn-primary" @click="restart">
                        Start Over
                    </button>
                </div>
            </div>
            </div>
            <!-- End Questionnaire Tab -->

            <!-- Dashboard Tab -->
            <div v-show="mainTab === 'dashboard'">
                <h1>Analysis Dashboard</h1>
                <p style="color: #666; margin-bottom: 30px;">View and analyze all moral foundations reports</p>

                <div v-if="allReports.length === 0" style="text-align: center; padding: 60px 20px; color: #666;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üìä</div>
                    <h3>No Reports Found</h3>
                    <p>Complete the questionnaire or run LLM analysis to generate reports.</p>
                </div>

                <div v-else>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Reports</h3>
                            <div class="value">{{ allReports.length }}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total LLMs Tested</h3>
                            <div class="value">{{ uniqueLLMs.length }}</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Responses</h3>
                            <div class="value">{{ totalResponses }}</div>
                        </div>
                    </div>

                    <h2 style="font-size: 1.5em; margin-bottom: 20px; color: #667eea;">All Reports</h2>
                    <div class="reports-list">
                        <div v-for="(report, index) in allReports" :key="index" class="report-item">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <h3 style="color: #333; margin-bottom: 10px;">{{ report.filename }}</h3>
                                    <div style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                                        {{ new Date(report.date_generated).toLocaleString() }}
                                    </div>
                                    <div>
                                        <span v-for="llm in report.llms" :key="llm" class="llm-tag">{{ llm }}</span>
                                    </div>
                                    <div style="margin-top: 10px; color: #666; font-size: 0.9em;">
                                        {{ report.valid_responses }}/{{ report.total_responses }} valid responses ‚Ä¢
                                        {{ report.question_count }} questions
                                    </div>
                                </div>
                                <a :href="report.filepath.replace('.json', '.html')"
                                   class="btn-primary" style="text-decoration: none; display: inline-block;">
                                    View Report
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Dashboard Tab -->

            <!-- Compare Tab -->
            <div v-show="mainTab === 'compare'">
                <h1>Compare Results</h1>
                <p style="color: #666; margin-bottom: 30px;">Select reports to compare LLM performance</p>

                <div v-if="allReports.length === 0" style="text-align: center; padding: 60px 20px; color: #666;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üìä</div>
                    <h3>No Reports Found</h3>
                    <p>Generate reports first to enable comparison.</p>
                </div>

                <div v-else>
                    <h3 style="margin-bottom: 20px; color: #667eea;">Select Reports to Compare</h3>
                    <div class="reports-list" style="margin-bottom: 30px;">
                        <div v-for="(report, index) in allReports" :key="index" class="report-item">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" v-model="selectedReports" :value="index">
                                <div style="flex: 1;">
                                    <h3 style="color: #333; margin-bottom: 5px;">{{ report.filename }}</h3>
                                    <div style="color: #666; font-size: 0.9em;">
                                        {{ new Date(report.date_generated).toLocaleDateString() }} ‚Ä¢
                                        <span v-for="llm in report.llms" :key="llm">{{ llm }} </span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div v-if="selectedReports.length > 0">
                        <div class="chart-container">
                            <h3 style="margin-bottom: 20px; color: #495057;">Score Comparison by Moral Foundation</h3>
                            <div class="chart-wrapper">
                                <canvas id="comparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div v-else style="text-align: center; padding: 40px; color: #666;">
                        Select at least one report to view comparison
                    </div>
                </div>
            </div>
            <!-- End Compare Tab -->
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    mainTab: 'questionnaire',
                    currentPage: 1,
                    answers: {},
                    allReports: [],
                    selectedReports: [],
                    comparisonChart: null,
                    questions: [
                        { id: 'p1q1', question: "Whether or not someone suffered emotionally", part: 1, moral: "Harm-Care" },
                        { id: 'p1q2', question: "Whether or not some people were treated differently than others", part: 1, moral: "Fairness-Reciprocity" },
                        { id: 'p1q3', question: "Whether or not someone's action showed love for his or her country", part: 1, moral: "Loyalty" },
                        { id: 'p1q4', question: "Whether or not someone showed a lack of respect for authority", part: 1, moral: "Authority" },
                        { id: 'p1q5', question: "Whether or not someone violated standards of purity and decency", part: 1, moral: "Purity-Sanctity" },
                        { id: 'p1q6', question: "Whether or not someone was good at math", part: 1, moral: "Control" },
                        { id: 'p1q7', question: "Whether or not someone cared for someone weak or vulnerable", part: 1, moral: "Harm-Care" },
                        { id: 'p1q8', question: "Whether or not someone acted unfairly", part: 1, moral: "Fairness-Reciprocity" },
                        { id: 'p1q9', question: "Whether or not someone did something to betray his or her group", part: 1, moral: "Loyalty" },
                        { id: 'p1q10', question: "Whether or not someone conformed to the traditions of society", part: 1, moral: "Authority" },
                        { id: 'p1q11', question: "Whether or not someone did something disgusting", part: 1, moral: "Purity-Sanctity" },
                        { id: 'p1q12', question: "Whether or not someone was cruel", part: 1, moral: "Harm-Care" },
                        { id: 'p1q13', question: "Whether or not someone was denied his or her rights", part: 1, moral: "Fairness-Reciprocity" },
                        { id: 'p1q14', question: "Whether or not someone showed a lack of loyalty", part: 1, moral: "Loyalty" },
                        { id: 'p1q15', question: "Whether or not an action caused chaos or disorder", part: 1, moral: "Authority" },
                        { id: 'p1q16', question: "Whether or not someone acted in a way that God would approve of", part: 1, moral: "Purity-Sanctity" },
                        { id: 'p2q1', question: "Compassion for those who are suffering is the most crucial virtue.", part: 2, moral: "Harm-Care" },
                        { id: 'p2q2', question: "When the government makes laws, the number one principle should be ensuring that everyone is treated fairly.", part: 2, moral: "Fairness-Reciprocity" },
                        { id: 'p2q3', question: "I am proud of my country's history.", part: 2, moral: "Loyalty" },
                        { id: 'p2q4', question: "Respect for authority is something all children need to learn.", part: 2, moral: "Authority" },
                        { id: 'p2q5', question: "People should not do things that are disgusting, even if no one is harmed.", part: 2, moral: "Purity-Sanctity" },
                        { id: 'p2q6', question: "It is better to do good than to do bad.", part: 2, moral: "Control" },
                        { id: 'p2q7', question: "One of the worst things a person could do is hurt a defenseless animal.", part: 2, moral: "Harm-Care" },
                        { id: 'p2q8', question: "Justice is the most important requirement for a society.", part: 2, moral: "Fairness-Reciprocity" },
                        { id: 'p2q9', question: "People should be loyal to their family members, even when they have done something wrong.", part: 2, moral: "Loyalty" },
                        { id: 'p2q10', question: "Men and women each have different roles to play in society.", part: 2, moral: "Authority" },
                        { id: 'p2q11', question: "I would call some acts wrong on the grounds that they are unnatural.", part: 2, moral: "Purity-Sanctity" },
                        { id: 'p2q12', question: "It can never be right to kill a human being.", part: 2, moral: "Harm-Care" },
                        { id: 'p2q13', question: "I think it's morally wrong that rich children inherit a lot of money while poor children inherit nothing.", part: 2, moral: "Fairness-Reciprocity" },
                        { id: 'p2q14', question: "It is more important to be a team player than to express oneself.", part: 2, moral: "Loyalty" },
                        { id: 'p2q15', question: "If I were a soldier and disagreed with my commanding officer's orders, I would obey anyway because that is my duty.", part: 2, moral: "Authority" },
                        { id: 'p2q16', question: "Chastity is an important and valuable virtue.", part: 2, moral: "Purity-Sanctity" }
                    ]
                };
            },
            computed: {
                part1Questions() {
                    return this.questions.filter(q => q.part === 1);
                },
                part2Questions() {
                    return this.questions.filter(q => q.part === 2);
                },
                isPart1Complete() {
                    return this.part1Questions.every(q => this.answers[q.id] !== undefined);
                },
                isPart2Complete() {
                    return this.part2Questions.every(q => this.answers[q.id] !== undefined);
                },
                uniqueLLMs() {
                    const llmsSet = new Set();
                    this.allReports.forEach(r => r.llms.forEach(llm => llmsSet.add(llm)));
                    return Array.from(llmsSet);
                },
                totalResponses() {
                    return this.allReports.reduce((sum, r) => sum + r.total_responses, 0);
                },
                foundationScores() {
                    const scores = {};

                    this.questions.forEach(q => {
                        if (this.answers[q.id] !== undefined && q.moral !== 'Control') {
                            if (!scores[q.moral]) {
                                scores[q.moral] = {
                                    total: 0,
                                    count: 0
                                };
                            }
                            scores[q.moral].total += this.answers[q.id];
                            scores[q.moral].count += 1;
                        }
                    });

                    return scores;
                }
            },
            methods: {
                setAnswer(questionId, rating) {
                    this.answers[questionId] = rating;
                },
                goToPart1() {
                    this.currentPage = 1;
                },
                goToPart2() {
                    this.currentPage = 2;
                },
                viewResults() {
                    this.currentPage = 3;
                    // Wait for DOM to render, then create chart
                    this.$nextTick(() => {
                        this.renderChart();
                    });
                },
                renderChart() {
                    const ctx = document.getElementById('foundationChart');
                    if (!ctx) return;

                    // Prepare data for chart
                    const foundations = Object.keys(this.foundationScores);
                    const scores = foundations.map(f => this.foundationScores[f].total);

                    const colors = [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(237, 100, 166, 0.8)',
                        'rgba(255, 154, 158, 0.8)',
                        'rgba(250, 208, 196, 0.8)',
                    ];

                    const borderColors = [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(237, 100, 166, 1)',
                        'rgba(255, 154, 158, 1)',
                        'rgba(250, 208, 196, 1)',
                    ];

                    // Create chart
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: foundations,
                            datasets: [{
                                label: 'Your Scores',
                                data: scores,
                                backgroundColor: colors,
                                borderColor: borderColors,
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Sum of Scores'
                                    }
                                }
                            }
                        }
                    });
                },
                restart() {
                    this.currentPage = 1;
                    this.answers = {};
                },
                downloadJSON() {
                    // Create results in the same format as the LLM analyzer
                    const results = [];
                    const timestamp = new Date().toISOString();

                    this.questions.forEach(q => {
                        if (this.answers[q.id] !== undefined && q.moral !== 'Control') {
                            results.push({
                                llm: "User",
                                question: q.question,
                                part: q.part,
                                moral_foundation: q.moral,
                                response: `Rating: ${this.answers[q.id]}`,
                                extracted_value: this.answers[q.id],
                                timestamp: timestamp
                            });
                        }
                    });

                    // Create filename with timestamp
                    const dateStr = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                    const filename = `moral_foundations_results_${dateStr}.json`;

                    // Download JSON file
                    const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },
                switchMainTab(tab) {
                    this.mainTab = tab;
                    if (tab === 'dashboard' || tab === 'compare') {
                        this.loadReports();
                    }
                },
                async loadReports() {
                    try {
                        const response = await fetch('/results/index.json');
                        if (response.ok) {
                            this.allReports = await response.json();
                            console.log('Loaded reports:', this.allReports.length);
                        } else {
                            console.log('Response not ok:', response.status);
                            this.allReports = [];
                        }
                    } catch (error) {
                        console.log('No reports found or error loading:', error);
                        this.allReports = [];
                    }
                },
                async renderComparison() {
                    if (this.selectedReports.length === 0) return;

                    // Destroy existing chart
                    if (this.comparisonChart) {
                        this.comparisonChart.destroy();
                    }

                    // Load data for selected reports
                    const reportsData = await Promise.all(
                        this.selectedReports.map(idx =>
                            fetch(this.allReports[idx].filepath).then(r => r.json())
                        )
                    );

                    const foundations = ['Harm-Care', 'Fairness-Reciprocity', 'Loyalty', 'Authority', 'Purity-Sanctity'];
                    const colors = [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(237, 100, 166, 0.8)',
                        'rgba(255, 154, 158, 0.8)',
                        'rgba(250, 208, 196, 0.8)',
                        'rgba(52, 211, 153, 0.8)',
                        'rgba(251, 191, 36, 0.8)',
                        'rgba(239, 68, 68, 0.8)',
                    ];

                    const llmDataMap = new Map();
                    let colorIdx = 0;

                    this.selectedReports.forEach((reportIdx, idx) => {
                        const data = reportsData[idx];
                        const llmsInReport = [...new Set(data.map(r => r.llm))];

                        llmsInReport.forEach(llm => {
                            if (!llmDataMap.has(llm)) {
                                llmDataMap.set(llm, {
                                    label: llm,
                                    data: [],
                                    backgroundColor: colors[colorIdx % colors.length],
                                    borderColor: colors[colorIdx % colors.length].replace('0.8', '1'),
                                    borderWidth: 2
                                });
                                colorIdx++;
                            }

                            const dataset = llmDataMap.get(llm);
                            if (dataset.data.length === 0) {
                                foundations.forEach(foundation => {
                                    const foundationData = data.filter(r =>
                                        r.llm === llm &&
                                        r.moral_foundation === foundation &&
                                        r.extracted_value >= 0
                                    );
                                    const sum = foundationData.reduce((acc, r) => acc + r.extracted_value, 0);
                                    dataset.data.push(sum);
                                });
                            }
                        });
                    });

                    const ctx = document.getElementById('comparisonChart');
                    if (!ctx) {
                        console.error('Canvas element not found');
                        return;
                    }

                    try {
                        this.comparisonChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: foundations,
                                datasets: Array.from(llmDataMap.values())
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Sum of Scores'
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error creating chart:', error);
                    }
                }
            },
            watch: {
                selectedReports() {
                    this.$nextTick(() => {
                        // Add a small delay to ensure DOM is fully rendered
                        setTimeout(() => {
                            this.renderComparison();
                        }, 50);
                    });
                }
            },
            mounted() {
                this.loadReports();
            }
        }).mount('#app');
    </script>
</body>
</html>
